
unset LD_LIBRARY_PATH
module load samtools
module load deeptools/3.5.5

# ======== Ë∑ØÂæÑ ==========
BASE_DIR=/data/RichardLuLab/Eric/MTORCUTTAG
OUT_DIR=${BASE_DIR}/bw_RPGC
mkdir -p ${OUT_DIR}

# ======== Ê†∑Êú¨ÂàóË°®ÔºàÂèØÊîπÔºâ==========
for SAMPLE in A13 A14 A15 K1N K2N K3N K4N K5N
do
    BAM=${BASE_DIR}/${SAMPLE}/${SAMPLE}.hg38.sorted.bam
    BW=${OUT_DIR}/${SAMPLE}.RPGC.bw

    if [ ! -s $BAM ]; then
        echo "‚ùå Missing BAM for ${SAMPLE}, skipping..."
        continue
    fi

    echo "üöÄ Generating RPGC bigWig for ${SAMPLE}..."

    bamCoverage \
        -b $BAM \
        -o $BW \
        --binSize 10 \
        --normalizeUsing RPGC \
        --effectiveGenomeSize 2913022398 \
        --ignoreForNormalization chrX \
        --extendReads \
        --numberOfProcessors 8 \
        --verbose

    if [ -s $BW ]; then
        echo "‚úÖ Finished: ${BW}"
    else
        echo "‚ö†Ô∏è Failed for ${SAMPLE}, check log"
    fi
done

echo "üéâ All RPGC-normalized bigWigs generated!"

#######################

unset LD_LIBRARY_PATH
module load samtools
module load deeptools/3.5.5

# ======== Ë∑ØÂæÑ ==========
BASE_DIR=/data/RichardLuLab/Eric/MTORCUTTAG
OUT_DIR=${BASE_DIR}/bw_NIMA_RPGC
mkdir -p ${OUT_DIR}

# ======== Ê†∑Êú¨ÂàóË°®ÔºàÂèØÊîπÔºâ==========
for SAMPLE in A13 A14 A15 K1N K2N K3N K4N K5N
do
    BAM=${BASE_DIR}/${SAMPLE}/${SAMPLE}.sorted.bam
    BW=${OUT_DIR}/${SAMPLE}.RPGC.bw

    if [ ! -s $BAM ]; then
        echo "‚ùå Missing BAM for ${SAMPLE}, skipping..."
        continue
    fi

    echo "üöÄ Generating RPGC bigWig for ${SAMPLE}..."

    bamCoverage \
        -b $BAM \
        -o $BW \
        --binSize 10 \
        --normalizeUsing RPGC \
        --effectiveGenomeSize 2913022398 \
        --ignoreForNormalization chrX \
        --extendReads \
        --numberOfProcessors 8 \
        --verbose

    if [ -s $BW ]; then
        echo "‚úÖ Finished: ${BW}"
    else
        echo "‚ö†Ô∏è Failed for ${SAMPLE}, check log"
    fi
done

echo "üéâ All RPGC-normalized bigWigs generated!"

